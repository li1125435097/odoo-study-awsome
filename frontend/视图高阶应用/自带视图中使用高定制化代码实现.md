åœ¨ **Odoo 17** ä¸­ï¼Œå‰ç«¯æ¶æ„å·²å…¨é¢åŸºäº **OWLï¼ˆOdoo Web Libraryï¼‰2.x**ï¼Œè§†å›¾å®šä¹‰æ–¹å¼ä¸è‡ªå®šä¹‰ç»„ä»¶çš„é›†æˆæœºåˆ¶ç›¸æ¯”æ—§ç‰ˆæœ¬ï¼ˆå¦‚ v15 åŠæ›´æ—©ï¼‰æœ‰æ˜¾è‘—å˜åŒ–ã€‚ä»¥ä¸‹å†…å®¹ä¸¥æ ¼é’ˆå¯¹ **Odoo 17** çš„æœ€æ–°å®è·µè¿›è¡Œè¯´æ˜ã€‚

---

## ä¸€ã€Odoo 17 è§†å›¾çš„åŸºæœ¬å®šä¹‰

Odoo 17 çš„è§†å›¾ä»ç„¶é€šè¿‡ XML å®šä¹‰ï¼Œä½†åº•å±‚æ¸²æŸ“å¼•æ“å®Œå…¨ç”± OWL é©±åŠ¨ã€‚å¸¸è§è§†å›¾ç±»å‹åŒ…æ‹¬ï¼š

- `form`ï¼ˆè¡¨å•ï¼‰
- `list`ï¼ˆåŸ treeï¼‰
- `kanban`
- `graph`
- `calendar`
- `dashboard`ï¼ˆä¼ä¸šç‰ˆï¼‰

### ç¤ºä¾‹ï¼šå®šä¹‰ä¸€ä¸ªè¡¨å•è§†å›¾ï¼ˆXMLï¼‰

```xml
<!-- views/my_model_views.xml -->
<odoo>
    <record id="view_my_model_form" model="ir.ui.view">
        <field name="name">my.model.form</field>
        <field name="model">my.model</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="color_value" widget="my_color_picker"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
</odoo>
```

> æ³¨æ„ï¼š`tree` è§†å›¾åœ¨ Odoo 17 ä¸­å®˜æ–¹æ¨èä½¿ç”¨ `<list>` æ ‡ç­¾ï¼ˆå°½ç®¡ `<tree>` ä»å…¼å®¹ï¼‰ã€‚

---

## äºŒã€åœ¨ Odoo 17 ä¸­æ’å…¥é«˜åº¦å®šåˆ¶åŒ–ç»„ä»¶

Odoo 17 æä¾›ä¸¤ç§ä¸»è¦æ–¹å¼åµŒå…¥è‡ªå®šä¹‰ç»„ä»¶ï¼š

### âœ… æ–¹å¼ 1ï¼šè‡ªå®šä¹‰å­—æ®µ Widgetï¼ˆç»‘å®šåˆ°æ¨¡å‹å­—æ®µï¼‰

é€‚ç”¨äºéœ€è¦ä¸æ¨¡å‹å­—æ®µåŒå‘ç»‘å®šçš„åœºæ™¯ï¼ˆå¦‚é¢œè‰²é€‰æ‹©å™¨ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€è¯„åˆ†ç»„ä»¶ç­‰ï¼‰ã€‚

#### æ­¥éª¤ï¼š

1. **åˆ›å»º JS ç»„ä»¶ï¼ˆç»§æ‰¿ `FieldComponent`ï¼‰**
2. **æ³¨å†Œä¸ºå­—æ®µ widget**
3. **åœ¨ XML è§†å›¾ä¸­é€šè¿‡ `widget="xxx"` ä½¿ç”¨**

#### ç¤ºä¾‹ï¼šè‡ªå®šä¹‰é¢œè‰²é€‰æ‹©å™¨ï¼ˆOdoo 17 å†™æ³•ï¼‰

```js
// static/src/components/color_picker/color_picker.js
/** @odoo-module */
import { FieldComponent } from "@web/views/fields/field_component";
import { registry } from "@web/core/registry";

export class ColorPickerField extends FieldComponent {
    static template = "my_module.ColorPickerField";
    static props = {
        ...FieldComponent.props,
        // å¯æ‰©å±• props
    };

    onColorChange(ev) {
        this.props.update(ev.target.value); // æ›´æ–°å­—æ®µå€¼
    }

    get colorValue() {
        return this.props.value || "#000000";
    }
}

// æ³¨å†Œä¸ºå­—æ®µ widget
registry.category("fields").add("my_color_picker", ColorPickerField);
```

å¯¹åº”çš„ QWeb æ¨¡æ¿ï¼š

```xml
<!-- static/src/components/color_picker/color_picker.xml -->
<templates xml:space="preserve">
    <t t-name="my_module.ColorPickerField">
        <input
            type="color"
            t-att-value="colorValue"
            t-on-change="onColorChange"
            class="o_color_picker_input"
        />
    </t>
</templates>
```

åœ¨è§†å›¾ä¸­ä½¿ç”¨ï¼š

```xml
<field name="color_value" widget="my_color_picker"/>
```

---

### âœ… æ–¹å¼ 2ï¼šæ’å…¥ç‹¬ç«‹çš„éå­—æ®µç»„ä»¶ï¼ˆä¸ç»‘å®šå­—æ®µï¼‰

é€‚ç”¨äºä»ªè¡¨ç›˜ã€åœ°å›¾ã€å›¾è¡¨ã€è‡ªå®šä¹‰æ“ä½œé¢æ¿ç­‰ã€‚

#### æ–¹æ³•ï¼šä½¿ç”¨ `<div t-component="MyCustomComponent"/>`

> âš ï¸ æ³¨æ„ï¼šæ­¤è¯­æ³•ä»…åœ¨ **è¡¨å•è§†å›¾çš„ `<sheet>` å†…éƒ¨** æˆ– **è‡ªå®šä¹‰ Action è§†å›¾** ä¸­æœ‰æ•ˆã€‚

#### ç¤ºä¾‹ï¼šåµŒå…¥ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶

```js
// static/src/components/counter/counter.js
/** @odoo-module */
import { Component } from "@odoo/owl";
import { registry } from "@web/core/registry";

export class CounterComponent extends Component {
    static template = "my_module.CounterComponent";

    setup() {
        this.state = useState({ count: 0 });
    }

    increment() {
        this.state.count++;
    }
}

// æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶ï¼ˆå¯é€‰ï¼Œè‹¥éœ€åœ¨æ¨¡æ¿ä¸­ç›´æ¥å¼•ç”¨ï¼‰
registry.category("components").add("CounterComponent", CounterComponent);
```

æ¨¡æ¿ï¼š

```xml
<!-- static/src/components/counter/counter.xml -->
<templates xml:space="preserve">
    <t t-name="my_module.CounterComponent">
        <div class="counter-widget">
            <span>Count: <t t-esc="state.count"/></span>
            <button t-on-click="increment">+1</button>
        </div>
    </t>
</templates>
```

åœ¨è¡¨å•è§†å›¾ä¸­æ’å…¥ï¼š

```xml
<form>
    <sheet>
        <group>
            <field name="name"/>
        </group>
        <!-- æ’å…¥è‡ªå®šä¹‰ç»„ä»¶ -->
        <div t-component="CounterComponent"/>
    </sheet>
</form>
```

> ğŸ”” **é‡è¦**ï¼šç¡®ä¿ç»„ä»¶å·²åœ¨èµ„äº§ä¸­åŠ è½½ï¼Œå¹¶ä¸”æ¨¡æ¿è¢«æ­£ç¡®å¼•å…¥ã€‚

---

## ä¸‰ã€èµ„äº§ï¼ˆAssetsï¼‰é…ç½®ï¼ˆOdoo 17ï¼‰

åœ¨ `__manifest__.py` ä¸­å£°æ˜å‰ç«¯èµ„æºï¼š

```python
# __manifest__.py
{
    'name': 'My Module',
    'version': '1.0',
    'depends': ['web'],
    'assets': {
        'web.assets_backend': [
            # JS
            'my_module/static/src/components/color_picker/color_picker.js',
            'my_module/static/src/components/counter/counter.js',
            # XML æ¨¡æ¿ï¼ˆè‡ªåŠ¨åŠ è½½ï¼‰
            'my_module/static/src/components/**/*.xml',
        ],
    },
    'data': [
        'views/my_model_views.xml',
    ],
}
```

> âœ… Odoo 17 ä¼šè‡ªåŠ¨åŠ è½½ `static/src/**/*.xml` ä¸­çš„æ¨¡æ¿ï¼ˆåªè¦è·¯å¾„åœ¨ assets ä¸­æˆ–è¢« JS importï¼‰ã€‚

---

## å››ã€é«˜çº§æŠ€å·§

### 1. è®¿é—®å½“å‰è®°å½•æ•°æ®ï¼ˆåœ¨ç»„ä»¶ä¸­ï¼‰

åœ¨å­—æ®µç»„ä»¶ä¸­ï¼Œå¯é€šè¿‡ `this.props.record` è·å–å½“å‰è®°å½•ï¼š

```js
const record = this.props.record;
const fieldName = this.props.name;
const value = record.data[fieldName];
```

### 2. è§¦å‘ Odoo åŠ¨ä½œï¼ˆå¦‚æ‰“å¼€çª—å£ã€ä¿å­˜è¡¨å•ï¼‰

ä½¿ç”¨æœåŠ¡ï¼ˆservicesï¼‰ï¼š

```js
import { useService } from "@web/core/utils/hooks";

setup() {
    this.actionService = useService("action");
    this.orm = useService("orm");
}

async openAnotherView() {
    await this.actionService.doAction({
        type: 'ir.actions.act_window',
        res_model: 'my.other.model',
        views: [[false, 'form']],
    });
}
```

### 3. æ ·å¼éš”ç¦»

ä½¿ç”¨ SCSS æ–‡ä»¶å¹¶åŠ å…¥ assetsï¼š

```scss
/* static/src/components/color_picker/color_picker.scss */
.o_color_picker_input {
    width: 60px;
    height: 40px;
}
```

å¹¶åœ¨ assets ä¸­å¼•å…¥ï¼š

```python
'web.assets_backend': [
    'my_module/static/src/components/color_picker/color_picker.scss',
    # ...
]
```

---

## äº”ã€è°ƒè¯•å»ºè®®

- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œæ£€æŸ¥ç»„ä»¶æ˜¯å¦åŠ è½½ã€‚
- æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ `Template not found` é”™è¯¯ â†’ æ£€æŸ¥ XML è·¯å¾„å’Œ `t-name`ã€‚
- ä½¿ç”¨ `console.log` æˆ– Owl DevToolsï¼ˆéœ€å®‰è£…ï¼‰è°ƒè¯•ç»„ä»¶çŠ¶æ€ã€‚

---

## å…­ã€æ€»ç»“

| éœ€æ±‚ | æ¨èæ–¹å¼ |
|------|--------|
| è‡ªå®šä¹‰å­—æ®µè¾“å…¥ï¼ˆå¦‚é¢œè‰²ã€è¯„åˆ†ï¼‰ | ç»§æ‰¿ `FieldComponent` + `widget` å±æ€§ |
| ç‹¬ç«‹ UI æ¨¡å—ï¼ˆå›¾è¡¨ã€æ“ä½œé¢æ¿ï¼‰ | `<div t-component="..."/>` + æ³¨å†Œç»„ä»¶ |
| å¤æ‚äº¤äº’ï¼ˆè°ƒç”¨ RPCã€æ‰“å¼€è§†å›¾ï¼‰ | ä½¿ç”¨ `useService("orm")`ã€`useService("action")` |

---

å¦‚ä½ æœ‰å…·ä½“åœºæ™¯ï¼ˆä¾‹å¦‚â€œåœ¨ Kanban å¡ç‰‡ä¸­åµŒå…¥è§†é¢‘æ’­æ”¾å™¨â€æˆ–â€œå®ç°ä¸€ä¸ªæ‹–æ‹½æ’åºçš„å¤šå¯¹å¤šå­—æ®µâ€ï¼‰ï¼Œæˆ‘å¯ä»¥æä¾›é’ˆå¯¹æ€§çš„ Odoo 17 å®ç°æ–¹æ¡ˆã€‚